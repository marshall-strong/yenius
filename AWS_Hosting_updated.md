# AWS Hosting

https://docs.aws.amazon.com/IAM/latest/UserGuide/introduction.html  

## IAM = AWS Identity and Access Management  

### Root 

**AWS account**: 157703510654  
**Root user**: marshallstrong123@gmail.com  

### Create Admin User Group

**IAM > User groups**
Create new group: `admins`  
Attach permissions policy **AdministratorAccess**

**IAM > Policies > AdministratorAccess**
**Policy ARN**: arn:aws:iam::aws:policy/AdministratorAccess  
**Description**: Provides full access to AWS services and resources.  
**JSON**:  

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": "*",
      "Resource": "*"
    }
  ]
}
```

### Create Admin User

Create new user: `admin`  
Enable both programmatic and control access.  
(Uncheck Require password reset)

Add user `admin` to group `admins` (group has the `AdministratorAccess` policy attached).  

Review:
  User name: admin
  AWS access type: Programmatic access and AWS Management Console access
  Console password type: Autogenerated
  Require password reset: No
  Permissions boundary: Permissions boundrary is not set

**User Security Credentials**
	User name: 				    admin  
	Password:					    }8{Ia'nWAh|#*9v  
	Access key ID:			  AKIASJN64TJ7OBIUD2OT  
	Secret access key: 	  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  
	Console login link: 	https://157703510654.signin.aws.amazon.com/console  


Created new users `yenius-dev` and `yenius-prod`
Enabled both programmatic and console access for both users

from yenius_new_user_credentials.csv:  

	User name: 				yenius-dev
	Password:					^%E*!=0os9pqPpK
	Access key ID:			AKIASJN64TJ7CJQKRP3T
	Secret access key: 	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
	Console login link: 	https://157703510654.signin.aws.amazon.com/console

	User name: 				yenius-prod
	Password:					}'EU)Iq{nY!7f1u
	Access key ID:			AKIASJN64TJ7HK3VYFJK
	Secret access key: 	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
	Console login link: 	https://157703510654.signin.aws.amazon.com/console


Both IAM users need to use the Console login link to reset their console access passwords immediately after logging in for the first time:

	User name: 				yenius-dev
	Old Password:			^%E*!=0os9pqPpK
	New Password: 		LdmH,Z6xv}XZ]H]	

	User name: 				yenius-prod
	Old Password:			}'EU)Iq{nY!7f1u
	New Password: 		iS?|`*r=CaKE$p8	
	

# [Viewing Photos in an Amazon S3 Bucket from a Browser](https://docs.aws.amazon.com/sdk-for-javascript/v2/developer-guide/s3-example-photos-view.html)  

[Setting permissions for website access](https://docs.aws.amazon.com/AmazonS3/latest/userguide/WebsiteAccessPermissionsReqd.html)

## Create the Bucket

In the [Amazon S3 console](https://console.aws.amazon.com/s3/), create an Amazon S3 bucket where you can store albums and photos.  

General configuration  
  Bucket name:      `yenius-dev`  
  AWS Region:       `us-east-2` (US East Ohio)  

Block Public Access settings for this bucket
  Uncheck the box to turn off the "Block *all* public access" setting.  

## [Create an Identity Pool](https://docs.aws.amazon.com/sdk-for-javascript/v2/developer-guide/getting-started-browser.html#getting-started-browser-create-identity-pool)  

1. Sign in to the [Amazon Cognito console](https://console.aws.amazon.com/cognito/).  

2. Choose **Manage Identity Pools** on the console opening page.  

3. On the next page, choose **Create new identity pool**.  

4. In the **Getting started wizard**...

- Type a name for your identity pool in **Identity pool name**. (`yenius-dev`)  

- Choose **Enable access to unauthenticated identities**.  

- Choose **Create Pool**.  

5. On the **Identify the IAM roles to use with your new identity pool** page...  

Before you can begin using your new Amazon Cognito identity pool, you must assign one or more IAM roles to determine the level of access you want your application end users to have to your AWS resources. Identity pools define two types of identities: authenticated and unauthenticated. Each can be assigned their own role in IAM. Authenticated identities belong to users who are authenticated by a public login provider (Amazon Cognito user pools, Facebook, Google, SAML, or any OpenID Connect Providers) or a developer provider (your own backend authentication process), while unauthenticated identities typically belong to guest users.  

When Amazon Cognito receives a user request, the service will determine if the request is either authenticated or unauthenticated, determine which role is associated with that authentication type, and then use the policy attached to that role to respond to the request. For a list of fine-grained IAM role example policies to choose from, see [IAM Roles](https://docs.aws.amazon.com/cognito/latest/developerguide/iam-roles.html) in the *Amazon Cognito Developer Guide*.  

**Note**  

As a best practice, define policies that follow the principle of granting least privilege. In other words, the policies should include only the permissions that users require to perform their tasks. For more information, see [Grant Least Privilege](https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege) in the *IAM User Guide*. Remember that unauthenticated identities are assumed by users who do not log in to your app. Typically, the permissions that you assign for unauthenticated identities should be more restrictive than those for authenticated identities.  

- Click **View Details** to see the names of the two IAM roles created for your identity pool. Make a note of the name of the role for unauthenticated identities. You need this name to add the required policy for Amazon Polly.  

Role Summary: Authenticated  
Role Description:   Your authenticated identities would like access to Cognito.  
IAM Role:           Create a new IAM Role  
Role Name:          `Cognito_yeniusdevAuth_Role`  
Policy Document:  
```
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "mobileanalytics:PutEvents",
        "cognito-sync:*",
        "cognito-identity:*"
      ],
      "Resource": [
        "*"
      ]
    }
  ]
}
```

Role Summary: Unauthenticated  
Role Description:   Your unauthenticated identities would like access to Cognito.  
IAM Role:           Create a new IAM Role  
Role Name:          `Cognito_yeniusdevUnauth_Role`  

- Choose **Allow**.  

6. On the Sample Code Page, select "JavaScript" from the Platform list. Then copy or write down the sample code.   
On the **Sample code** page, select the Platform of *JavaScript*. Then, copy or write down the identity pool ID and the Region. You need these values to replace REGION and IDENTITY_POOL_ID in your browser script.  

- Download the AWS SDK  
  - [Download the AWS SDK for JavaScript](https://github.com/aws/aws-sdk-js/releases)  
  - [Developer Guide](https://docs.aws.amazon.com/sdk-for-javascript/v2/developer-guide/getting-started-browser.html)

- Get AWS Credentials  

```
// Initialize the Amazon Cognito credentials provider
AWS.config.region = 'us-east-2'; // Region
AWS.config.credentials = new AWS.CognitoIdentityCredentials({
    IdentityPoolId: 'us-east-2:30baa935-7d14-42ef-b1ce-e4aaa0cdb056',
});
```

- Then initialize the credentials provider:  
- [Cognito Identity Reference for Javascript](https://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/CognitoIdentity.html)
- [Cognito Credentials Reference for Javascript](https://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/CognitoIdentityCredentials.html)

After you create your Amazon Cognito identity pool, you're ready to add permissions for Amazon Polly that are needed by your browser script.  


## Configure Role Permissions  

To allow viewing of albums and photos, you have to add permissions to the IAM roles of the identity pool that you just created. Start by creating a policy as follows:  

1. Open the [IAM console](https://console.aws.amazon.com/iam/).  

2. In the navigation pane on the left, choose **Policies**, an then choose the **Create policy** button.  

3. On the **JSON** tab, enter the following JSON definition:  

```
{
    "Version": "2012-10-17",
    "Id": "YeniusDevBucketPolicy",
    "Statement": [
        {
            "Sid": "PublicReadGetObject",
            "Effect": "Allow",
            "Principal": "*",
            "Action": [
                "s3:GetObject"
            ],
            "Resource": [
                "arn:aws:s3:::yenius-dev/*"
            ]
        }
    ]
}
```

4. Choose the **Review policy** button, name the policy and provide a description, then choose the **Create policy** button.  

Policy name:        `YeniusDevBucketPolicy`
Policy description: `...`

5. Attach the newly created policy (`YeniusDevBucketPolicy`) to IAM role for the **unauthenticated** identity that Amazon Cognito created during **Create an Identity Pool** (`Cognito_yeniusdevUnauth_Role`).

  - After the policy is created, navigate back to the [IAM console](https://console.aws.amazon.com/iam/) and sign in as the root user.  

  - In the navigation pane on the left, under **Access management**, select **Roles**.  

  - Select the IAM role for the **unauthenticated** identity that Amazon Cognito created earlier (`Cognito_yeniusdevUnauth_Role`) to bring up a **Summary** page.

  - Under the **Permissions** tab, choose the **Attach policies** button to bring up an **Attach Permissions** page.  

  - On the **Attach Permissions** page, to quickly find the new policy, open the **Filter policies** list and choose **Customer managed**.  

  - Check the box next to the newly created policy (`YeniusDevBucketPolicy`), then choose the **Attach policy** button. 

For additional information about creating an IAM role, see [Creating a Role to Delegate Permissions to an AWS Service](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_create_for-service.html) in the *IAM User Guide*.  


## [Configure CORS](https://docs.aws.amazon.com/sdk-for-javascript/v2/developer-guide/cors.html#configuring-cors-s3-bucket)  

Before the browser script can access the Amazon S3 bucket, you have to set up its CORS configuration.  
The CORS configuration, written in JSON, defines a way for client web applications that are loaded in one domain to interact with resources in a different domain.  

1. Open the [Amazon S3 console](https://s3.console.aws.amazon.com/s3) and sign in as the root user.  

2. In the navigation pane on the left, select **Buckets**, then select your bucket (`yenius-dev`).  

3. Select the **Permissions** tab, then scoll down to the **Cross-origin resource sharing (CORS)** panel and choose the **Edit** button.

4. Paste the CORS configuration below into the **CORS Configuration Editor**:   

```json
[
    {
        "AllowedHeaders": [
            "*"
        ],
        "AllowedMethods": [
            "HEAD",
            "GET"
        ],
        "AllowedOrigins": [
            "*"
        ]
    }
]
```

5. Choose the **Save** button.  

**Important**: In the new S3 console, the CORS configuration must be JSON (as opposed to XML).  


## Create Albums and Upload Photos  

Because this example only allows users to view the photos that are already in the bucket, you need to create some folders in the bucket and upload photos to them.  

**Note** - For this example, the file names of the photo files must start with a single underscore ("_"). This character is important later for filtering.  

1. Open the [Amazon S3 console](https://s3.console.aws.amazon.com/s3) and sign in as the root user.  

2. In the navigation pane on the left, select **Buckets**, then select your bucket (`yenius-dev`).  

3. Choose the **Upload** button.  

4. On the **Upload** page, drag or choose the photo files or folders of photo files that you want to use.  

5. Click to expand the **Permissions** dropdown and open the **Access control list (ACL)** window.  

  - **Access control list (ACL)** -- select **Choose from predefined ACLs**  

  - **Predefined ACLs** -- select **Grant public-read access** (you will also need to check a box saying that you understand the risk of granting public-read access to the specified objects)  

6. Choose the Upload button (in the lower-left corner), then monitor upload progress on the next page.

## https://docs.aws.amazon.com/sdk-for-javascript/v2/developer-guide/s3-example-photos-view-full.html  


# Install AWS-SDK for JavaScript

https://yarnpkg.com/package/@aws-sdk/client-s3



# AWS-SDK for Ruby  

https://docs.aws.amazon.com/sdk-for-ruby/v3/api/_index.html  
















## [Edit S3 Block Public Access settings](https://docs.aws.amazon.com/AmazonS3/latest/userguide/WebsiteAccessPermissionsReqd.html#block-public-access-static-site)  

If you want to configure an existing bucket as a static website that has public access, you must edit Block Public Access settings for that bucket. 

1. Open the Amazon S3 console at https://console.aws.amazon.com/s3/.

2. Under Buckets, choose the name of your bucket. (`yenius-dev`)

3. Choose Permissions.

4. Under Block public access (bucket settings), choose Edit.

5. Clear Block all public access, and choose Save changes.

## [Add a bucket policy](https://docs.aws.amazon.com/AmazonS3/latest/userguide/WebsiteAccessPermissionsReqd.html#bucket-policy-static-site)

After you edit S3 Block Public Access settings, you can add a bucket policy to grant public read access to your bucket. When you grant public read access, anyone on the internet can access your bucket.  

1. Open the Amazon S3 console at https://console.aws.amazon.com/s3/.

2. Under Buckets, choose the name of your bucket. (`yenius-dev`)  

3. Choose Permissions.

4. Under Bucket Policy, choose Edit.

5. To grant public read access for your website, copy the following bucket policy, and paste it in the Bucket policy editor.

```
{
    "Version": "2012-10-17",
    "Id": "YeniusDevBucketPolicy",
    "Statement": [
        {
            "Sid": "PublicReadGetObject",
            "Effect": "Allow",
            "Principal": "*",
            "Action": [
                "s3:GetObject"
            ],
            "Resource": [
                "arn:aws:s3:::yenius-dev/*"
            ]
        }
    ]
}
```
6. Choose Save changes.  




https://docs.aws.amazon.com/sdk-for-javascript/v2/developer-guide/s3-example-photos-view.html

https://docs.aws.amazon.com/AWSJavaScriptSDK/v3/latest/index.html  



## AWS SDK for JavaScript 

https://www.npmjs.com/package/aws-sdk

https://codesandbox.io/examples/package/aws-sdk  

### How To Install

**Install for Browser**:

To use the SDK in the browser, simply add the following script tag to your HTML pages:

    `<script src="https://sdk.amazonaws.com/js/aws-sdk-2.1028.0.min.js"></script>`

**Install for Node.js with Yarn**:  

https://yarnpkg.com/package/aws-sdk  

    `yarn add @aws-sdk`

    `yarn add @aws-sdk/client-s3`

**Install for Node.js with npm**:  

https://www.npmjs.com/package/aws-sdk

# Old Stuff


## Resoures

- [AWS Management Console](https://us-east-2.console.aws.amazon.com/console/home?region=us-east-2#)
- [AWS: Installing the AWS SDK for Ruby](https://docs.aws.amazon.com/sdk-for-ruby/v3/developer-guide/setup-install.html)
- [AWS: Configuring the AWS SDK for Ruby](https://docs.aws.amazon.com/sdk-for-ruby/v3/developer-guide/setup-config.html)
- [Heroku: Using AWS S3 to Store Static Assets and File Uploads](https://devcenter.heroku.com/articles/s3)
- [Heroku: Directo to S3 Image Uploads in Rails](https://devcenter.heroku.com/articles/direct-to-s3-image-uploads-in-rails)
- [Possible improvement?](https://www.mmbyte.com/article/40111.html)

## S3 Development Bucket

> ### bucket_name
> > `yenius--rails6-api--s3-bucket-dev`
>
> ### region
> > `us-east-2`
>
> ### access
> > *Objects can be public*
>
> ### bucket_policy
> > ```json
> > {
> >   "Version": "2012-10-17",
> >   "Id": "DevBucketAdminPolicy",
> >   "Statement": [
> >     {
> >       "Sid": "DevAdminStatement",
> >       "Effect": "Allow",
> >       "Principal": {
> >         "AWS": "arn:aws:iam::157703510654:user/yenius--rails6-api--s3-admin-user"
> >       },
> >       "Action": "s3:*",
> >       "Resource": [
> >         "arn:aws:s3:::yenius--rails6-api--s3-bucket-dev/*",
> >         "arn:aws:s3:::yenius--rails6-api--s3-bucket-dev"
> >        ]
> >      }
> >    ]
> > }
> > ```
>
> ### bucket_CORS
> > ```json
> > [
> >     {
> >         "AllowedHeaders": [
> >             "Authorization"
> >         ],
> >         "AllowedMethods": [
> >             "GET",
> >             "POST",
> >             "PUT"
> >         ],
> >         "AllowedOrigins": [
> >             "*"
> >         ],
> >         "ExposeHeaders": [],
> >         "MaxAgeSeconds": 3000
> >     }
> > ]
> > ```


## S3 Production Bucket

> ### bucket_name
> > `yenius--rails6-api--s3-bucket-prod`
>
> ### region
> > `us-east-2`
>
> ### access
> > *Objects can be public*
>
> ### bucket_policy
> > ```json
> > {
> >   "Version": "2012-10-17",
> >   "Id": "ProdBucketAdminPolicy",
> >   "Statement": [
> >     {
> >       "Sid": "ProdAdminStatement",
> >       "Effect": "Allow",
> >       "Principal": {
> >         "AWS": "arn:aws:iam::157703510654:user/yenius--rails6-api--s3-admin-user"
> >       },
> >       "Action": "s3:*",
> >       "Resource": [
> >         "arn:aws:s3:::yenius--rails6-api--s3-bucket-prod/*",
> >         "arn:aws:s3:::yenius--rails6-api--s3-bucket-prod"
> >        ]
> >      }
> >    ]
> > }
> > ```
>
> ### bucket_CORS
> > ```json
> > [
> >     {
> >         "AllowedHeaders": [
> >             "Authorization"
> >         ],
> >         "AllowedMethods": [
> >             "GET",
> >             "POST",
> >             "PUT"
> >         ],
> >         "AllowedOrigins": [
> >             "*"
> >         ],
> >         "ExposeHeaders": [],
> >         "MaxAgeSeconds": 3000
> >     }
> > ]
> > ```

## IAM

> ### IAM User Name
> > `yenius--rails6-api--s3-admin-user`
>
> ### IAM Group Name
> > `yenius--rails6-api--s3-admin-group`
>
> ### IAM Policy Name
> > `yenius--rails6-api--s3-admin-group-policy`
> > > the managed policy is attached to the group, and the user is a member of the group
>
> ### IAM Policy
> > ```json
> > {
> >   "Version": "2012-10-17",
> >   "Statement": [
> >     {
> >       "Sid": "YeniusRails6ApiS3AdminGroupPolicy",
> >       "Effect": "Allow",
> >       "Action": "s3:*",
> >       "Resource": [
> >         "arn:aws:s3:::yenius--rails6-api--s3-bucket-dev",
> >         "arn:aws:s3:::yenius--rails6-api--s3-bucket-dev/*",
> >         "arn:aws:s3:::yenius--rails6-api--s3-bucket-prod",
> >         "arn:aws:s3:::yenius--rails6-api--s3-bucket-prod/*"
> >       ]
> >     }
> >   ]
> > }
> > ```
